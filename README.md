node-fidonet-squish
===================

[![Build Status](https://travis-ci.org/askovpen/node-fidonet-squish.svg?branch=master)](https://travis-ci.org/askovpen/node-fidonet-squish)

The **Fidonet Squish** module is able to read headers and texts of Fidonet echomail messages from Squish message bases

[![(npm package version)](https://nodei.co/npm/fidonet-squish.png?downloads=true)](https://npmjs.org/package/fidonet-squish)

## Using Fidonet Squish

When you `require()` the installed module, you get a constructor that uses the path to a Squish echo base as its parameter:

```js
var Squish = require('fidonet-squish');
var echobase = Squish(basePath);
```

Names of echo base files are generated by appending lowercase extensions (`.sql`, `.sqi`, `.sqd`) to the given path.

The constructed object has the following methods:

### readSQL(callback)

Asynchronously reads the `.sql` file (Squish lastread storage) into memory and parses it, populating the variable `lastreads`

### readSQI(callback)

Asynchronously reads the `.sqi` file (Squish index) into memory and parses that index, populating the object's `.indexStructure` property with an array of objects with the following properties:

* `CRC` — Squish hash.

* `offset` — the physical offset of the message's data in the `.sqd` (header) file.

* `MessageNum0` — a message's rebased (zero-based) internal number. Starts from `0` (zero), i.e. `.indexStructure[0].MessageNum0 === 0`. The `basemsgnum` value from the “Squish fixed header” (see below) should be added to generate the actual internal number of a message. Deleted messages leave gaps in that numbering (such as `.indexStructure[i].MessageNum0 > i` and `.indexStructure[i].MessageNum0 > .indexStructure[i-1].MessageNum0 + 1`) until the message base is packed by an echoprocessor.


### readSQD(callback)

Asynchronously reads the `.sqd` file (Squish data) into memory, populating the object's `.SQD` property with a raw Buffer. Then calls `callback(error)`.

The data is cached. Subsequent calls to `.readSQD` won't repeat the reading operation unless the object's `.SQD` property is `null`.

### size()

Returns `.indexStructure.length` property (or `undefined` when `.indexStructure` is `null`).

### clearCache(cache)

...

### readHeader(number, callback)

...

### readAllHeaders(callback)

...

### decodeHeader(header, options)

...

### decodeMessage(header, options, callback)

...

### numbersForMSGID(MSGID, options, callback)

...


